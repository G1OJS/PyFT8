<!DOCTYPE html>
<html lang="en">


<head>
	<meta charset="utf-8">
	<title>PyFT8 Live Decodes</title>
	
	<style>
		body { font-family: sans-serif; background:#111; color:#eee; margin:1em; }
		.message-line > span {display:inline-block; font-family: sans-serif; background:#111; color:#8cf; width:80px;}
		.msg_field {color: #4af;text-decoration: none; cursor: pointer;}
		.msg_field:hover {text-decoration: underline; color: #0cf;}
		.message-line > *:hover {background: #222;}
	</style>
	
	<script>
		async function update_clock() {
			const t = new Date;
			const utc = ("0" + t.getUTCHours()).slice(-2) + ":" + ("0" + t.getUTCMinutes()).slice(-2) + ":" + ("0" + t.getUTCSeconds()).slice(-2);
			document.getElementById("clock").innerHTML = utc + " UTC";
		}
		
		async function refresh_decodes() {
		  try {
			const res = await fetch("data.json?");   
			const msgs = await res.json();
			const list = document.getElementById("msgs");
			list.innerHTML = "";
			msgs.forEach((m) => {
				const fields = [m.cyclestart_str.split('_')[1], m.freq, m.call_a, m.call_b, m.grid_rpt];
				const div = document.createElement("div");
				div.className = "message-line";
				fields.forEach((field, idx) => {
					const span = document.createElement("span");
					span.textContent = field;
					if (idx === 1 || idx === 2 || idx === 3) {
					  span.className = "msg_field";
					  span.onclick = () => {fetch(`/select_${idx}_${field}.txt`); return false;};
					  span.style.cursor = "pointer";
					  span.title = `Click ${field}`;
					}
					div.appendChild(span);
				});
				list.appendChild(div);
			});
		  } catch (e) {
			console.error("Refresh decodes failed:", e);
		  }
		}
		
		async function refresh_config() {
		  try {
			const res = await fetch("config.json?");   
			const config = await res.json();
			document.getElementById('txFreq').innerHTML = "Tx: "+ config.txFreq;
			document.getElementById('rxFreq').innerHTML = "Rx: "+ config.rxFreq;
		  } catch (e) {
			console.error("Refresh config failed:", e);
		  }
		}		
			
		setInterval(update_clock, 1000);
		setInterval(refresh_config, 250);
		setInterval(refresh_decodes, 250);
	</script>
	
</head>

<body>
	<div id='clock'></div>
	<div id='txFreq'></div>
	<div id='rxFreq'></div>
	<h3>Decodes</h3>
	<div id="msgs">Loading...</div>
</body>


</html>
